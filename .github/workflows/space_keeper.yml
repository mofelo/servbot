name: 🛡️ Gradio Space 每6小时保活

on:
  schedule:
    # 每6小时运行一次 (00:00, 06:00, 12:00, 18:00 UTC)
    - cron: '0 */6 * * *'
  workflow_dispatch:  # 允许手动触发
  push:
    branches: [ main ]

jobs:
  keep-alive:
    runs-on: ubuntu-latest
    timeout-minutes: 8
    
    steps:
    - name: 📥 检出代码
      uses: actions/checkout@v4
      
    - name: 🐍 设置 Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
        
    - name: 🔧 安装 Chrome
      run: |
        sudo apt-get update
        sudo apt-get install -y wget gnupg
        wget -q -O - https://dl-ssl.google.com/linux/linux_signing_key.pub | sudo apt-key add -
        echo "deb [arch=amd64] http://dl.google.com/linux/chrome/deb/ stable main" | sudo tee /etc/apt/sources.list.d/google-chrome.list
        sudo apt-get update
        sudo apt-get install -y google-chrome-stable
        google-chrome --version
        
    - name: 📦 安装 Python 依赖
      run: |
        pip install selenium webdriver-manager
        
    - name: 🎯 保活 Space
      env:
        HF_SPACE_URL: ${{ secrets.HF_SPACE_URL }}
      run: |
        echo "🚀 开始保活流程..."
        echo "📍 目标: ${HF_SPACE_URL:-https://ka1q-shang.hf.space}"
        echo "🕐 时间: $(date)"
        
        python space_keeper.py "${HF_SPACE_URL:-https://ka1q-shang.hf.space}"
        
    - name: 📊 运行报告
      if: always()
      run: |
        echo "✅ 保活任务完成！"
        echo "📅 日志时间: $(date)"
